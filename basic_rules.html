<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã‚³ãƒ¼ã‚¹ãƒ‡ãƒ“ãƒ¥ãƒ¼ã€Œã„ã‚ã¯ã€ï¼ˆåŸºæœ¬ãƒ«ãƒ¼ãƒ«ï¼‰ | 3ã‚¿ãƒƒãƒ—ãƒ«ãƒ¼ãƒ«ã‚º</title>

  <style>
    :root{
      --green:#00bfa5;
      --deep:#007f72;
      --yellow:#FFD84D;
      --bg:#f6fff8;
      --card:#ffffff;
      --shadow: 0 2px 12px rgba(0,0,0,0.08);
      --shadowSoft: 0 2px 10px rgba(0,0,0,0.06);
      --border: rgba(0,0,0,0.06);
    }

    body{
      font-family: "Helvetica","Arial",sans-serif;
      background: var(--bg);
      margin:0;
      padding-bottom: 90px; /* bottom nav */
      color:#222;
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
    header{
      background: var(--green);
      color:#fff;
      text-align:center;
      padding: 18px 14px 20px;
      font-size: 22px;
      font-weight: 900;
      border-bottom-left-radius: 28px;
      border-bottom-right-radius: 28px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.10);
      position: sticky;
      top:0;
      z-index: 20;
    }
    header .sub{
      display:block;
      font-size: 12px;
      opacity: .95;
      margin-top: 6px;
      font-weight: 700;
      letter-spacing: .02em;
    }

    /* ä¸Šéƒ¨ãƒ–ãƒ­ãƒƒã‚¯ */
    .topArea{
      width: 92%;
      max-width: 760px;
      margin: 14px auto 6px;
    }

    .topBtn{
      display:block;
      width: 100%;
      text-align:center;
      background: var(--yellow);
      color:#333;
      text-decoration:none;
      font-weight: 900;
      padding: 14px 0;
      border-radius: 40px;
      box-shadow: 0 5px 12px rgba(0,0,0,0.12);
      transition:.15s ease;
      font-size: 18px;
    }
    .topBtn:active{ transform: translateY(1px); }

    /* æ¤œç´¢ */
    .searchWrap{
      margin: 12px auto 10px;
      background:#fff;
      border-radius: 22px;
      box-shadow: var(--shadowSoft);
      border: 1px solid var(--border);
      overflow:hidden;
    }
    .searchWrap input{
      width:100%;
      border:none;
      outline:none;
      padding: 14px 14px;
      font-size: 16px;
      background:#fff;
    }

    /* ã‚«ãƒ†ã‚´ãƒªãƒãƒƒãƒ—ï¼ˆæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰ */
    .chipRow{
      width: 92%;
      max-width: 760px;
      margin: 10px auto 10px;
      display:flex;
      gap:10px;
      overflow-x:auto;
      padding-bottom: 6px;
      -webkit-overflow-scrolling: touch;
    }
    .chipRow::-webkit-scrollbar{ height:6px; }
    .chipRow::-webkit-scrollbar-thumb{ background: rgba(0,0,0,0.12); border-radius: 20px; }

    .chip{
      flex: 0 0 auto;
      background:#fff;
      border: 1px solid var(--border);
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 900;
      color: var(--deep);
      cursor:pointer;
      user-select:none;
      white-space: nowrap;
      transition: .12s ease;
    }
    .chip:active{ transform: translateY(1px); }
    .chip.active{
      background: rgba(0,191,165,0.12);
      border-color: rgba(0,191,165,0.35);
    }

    /* æ¤œç´¢çµæœ */
    .results{
      width:92%;
      max-width: 760px;
      margin: 10px auto 6px;
      display:none;
      background: #fff;
      border-radius: 18px;
      border: 1px solid var(--border);
      box-shadow: var(--shadowSoft);
      overflow:hidden;
    }
    .resultsHeader{
      padding: 12px 14px;
      font-weight: 900;
      color: var(--deep);
      border-bottom: 1px solid var(--border);
      background: linear-gradient(#fff, #fbfffd);
    }
    .resultsGrid{
      padding: 12px;
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:10px;
    }

    /* ã‚«ãƒ†ã‚´ãƒªä¸€è¦§ï¼ˆ2åˆ—ï¼‰ */
    .categoryGrid{
      width: 92%;
      max-width: 760px;
      margin: 10px auto 18px;
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }

    /* detailsã‚«ãƒ¼ãƒ‰ */
    details{
      background: var(--card);
      border-radius: 18px;
      box-shadow: var(--shadowSoft);
      border: 1px solid var(--border);
      overflow:hidden;
    }

    /* âœ… ã‚«ãƒ†ã‚´ãƒªè¦‹å‡ºã—ï¼ˆsummaryï¼‰ã‚’1è¡Œã§ç¶ºéº—ã« */
    summary{
      list-style:none;
      cursor:pointer;
      padding:16px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-weight:900;
      color: var(--deep);
      font-size:18px;
      white-space:nowrap;
    }
    summary::-webkit-details-marker{ display:none; }

    summary > span:first-child{
      flex:1;
      min-width:0;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }

    .chev{
      flex:0 0 auto;
      font-size:18px;
      opacity:.8;
      transition: transform .15s ease;
    }
    details[open] .chev{ transform: rotate(180deg); }

    /* âœ… ãƒ«ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ã¯å¸¸ã«ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³å†…ï¼ˆ1ä»¶ã§ã‚‚å¤–ã«å‡ºã•ãªã„ï¼‰ */
    .rulesGrid{
      padding:12px 12px 14px;
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:10px;
      border-top: 1px solid var(--border);
      background: linear-gradient(#ffffff, #fbfffd);
    }

    /* âœ… ãƒœã‚¿ãƒ³ã®æ–‡å­—ãŒç¸¦ã«æ½°ã‚Œãªã„ */
    .ruleBtn{
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;

      min-height: 56px;
      height:auto;
      padding: 12px 10px;

      background:#fff;
      border-radius: 14px;
      text-decoration:none;
      color:#222;
      font-weight: 900;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border: 1px solid var(--border);

      line-height: 1.25;
      font-size: 15px;

      word-break: keep-all;       /* å¤‰ãª1æ–‡å­—æ”¹è¡Œã‚’æŠ‘åˆ¶ */
      overflow-wrap: break-word;  /* ãã‚Œã§ã‚‚é•·ã„æ™‚ã ã‘æŠ˜ã‚‹ */
      transition: .12s ease;
    }
    .ruleBtn:active{ transform: translateY(1px); }

    /* ç©º */
    .empty{
      padding: 12px 12px 14px;
      color:#666;
      font-size: 14px;
    }

    /* ã‚¹ãƒãƒ›æœ€é©åŒ– */
    @media (max-width: 420px){
      header{ font-size: 20px; }
      .topBtn{ font-size: 17px; }
      summary{ font-size: 17px; }
      .ruleBtn{ font-size: 14px; min-height: 54px; }
    }

    /* ä¸‹éƒ¨ãƒŠãƒ“ */
    .bottom-nav{
      position: fixed;
      left:0; bottom:0;
      width:100%;
      background:#fff;
      border-top: 1px solid #ddd;
      display:flex;
      justify-content: space-around;
      align-items:center;
      height: 70px;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.08);
      z-index: 1000;
    }
    .bottom-nav img{
      width: 50px;
      height:auto;
      display:block;
    }
  </style>
</head>

<body>
  <header>
    ğŸƒ ã‚³ãƒ¼ã‚¹ãƒ‡ãƒ“ãƒ¥ãƒ¼ã€Œã„ã‚ã¯ã€
    <span class="sub">ãƒ©ã‚¦ãƒ³ãƒ‰ã®æµã‚ŒãŒã‚ã‹ã‚‹â€œè¶…å…¥é–€â€</span>
  </header>

  <div class="topArea">
    <a class="topBtn" href="index.html">ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</a>

    <div class="searchWrap">
      <input id="searchInput" type="text" placeholder="åŸºæœ¬ãƒ«ãƒ¼ãƒ«ã‚’æ¤œç´¢..." autocomplete="off" />
    </div>
  </div>

  <!-- ã‚«ãƒ†ã‚´ãƒªãƒãƒƒãƒ— -->
  <div class="chipRow" id="chipRow"></div>

  <!-- æ¤œç´¢çµæœ -->
  <section class="results" id="resultsBox">
    <div class="resultsHeader">æ¤œç´¢çµæœ</div>
    <div class="resultsGrid" id="resultsGrid"></div>
  </section>

  <!-- ã‚«ãƒ†ã‚´ãƒªï¼ˆ2åˆ—ï¼‰ -->
  <main class="categoryGrid" id="categoryGrid"></main>

  <!-- ä¸‹éƒ¨ãƒŠãƒ“ -->
  <nav class="bottom-nav">
    <a href="index.html"><img src="home-icon.png" alt="ãƒ›ãƒ¼ãƒ " /></a>
    <a href="rules.html"><img src="book-icon.png" alt="ãƒ«ãƒ¼ãƒ«ä¸€è¦§" /></a>
    <a href="favorites.html"><img src="star-icon.png" alt="ãŠæ°—ã«å…¥ã‚Š" /></a>
  </nav>

  <script>
    const esc = (s) => String(s ?? "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");

    document.addEventListener("DOMContentLoaded", async () => {
      const chipRow = document.getElementById("chipRow");
      const grid = document.getElementById("categoryGrid");

      const resultsBox = document.getElementById("resultsBox");
      const resultsGrid = document.getElementById("resultsGrid");
      const searchInput = document.getElementById("searchInput");

      let rules = [];
      try{
        const res = await fetch("basic_rules.json");
        rules = await res.json();
      }catch(e){
        grid.innerHTML = `<div class="empty">basic_rules.json ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</div>`;
        return;
      }

      // idé †
      rules.sort((a,b)=> (Number(a.id)||0) - (Number(b.id)||0));

      // levelï¼ˆã‚«ãƒ†ã‚´ãƒªï¼‰ã§ã‚°ãƒ«ãƒ¼ãƒ—
      const groups = new Map();
      for(const r of rules){
        const level = (r.level || "ãã®ä»–").trim();
        if(!groups.has(level)) groups.set(level, []);
        groups.get(level).push(r);
      }

      const levels = Array.from(groups.keys());

      // ãƒãƒƒãƒ—ç”Ÿæˆ
      chipRow.innerHTML = levels.map((lv, idx)=>`
        <div class="chip ${idx===0 ? "active":""}" data-level="${esc(lv)}">${esc(lv)}</div>
      `).join("");

      // ã‚«ãƒ†ã‚´ãƒªï¼ˆdetailsï¼‰ç”Ÿæˆï¼šâœ…1ä»¶ã§ã‚‚å¿…ãšä¸­ã«æ ¼ç´ï¼ˆå¤–ã«å‡ºã•ãªã„ï¼‰
      grid.innerHTML = levels.map((lv, idx)=>{
        const safeId = "cat_" + lv.replace(/\s+/g,"_").replace(/[^\wã-ã‚“ã‚¡-ãƒ¶ä¸€-é¾ ãƒ¼]/g,"");
        const items = groups.get(lv) || [];

        const buttons = items.map(r=>{
          const title = esc(r.title);
          const id = Number(r.id);
          return `<a class="ruleBtn" href="basic_rule_detail.html?id=${id}">${title}</a>`;
        }).join("");

        return `
          <details id="${safeId}" data-level="${esc(lv)}">
            <summary>
              <span>${esc(lv)}</span>
              <span class="chev">â–¼</span>
            </summary>
            <div class="rulesGrid">
              ${buttons || `<div class="empty">ã“ã®ã‚«ãƒ†ã‚´ãƒªã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</div>`}
            </div>
          </details>
        `;
      }).join("");

      // ãƒãƒƒãƒ—ã‚¯ãƒªãƒƒã‚¯ï¼šè©²å½“ã‚«ãƒ†ã‚´ãƒªã¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼†open
      chipRow.querySelectorAll(".chip").forEach(chip=>{
        chip.addEventListener("click", ()=>{
          chipRow.querySelectorAll(".chip").forEach(c=>c.classList.remove("active"));
          chip.classList.add("active");

          const lv = chip.dataset.level;
          const target = grid.querySelector(`details[data-level="${CSS.escape(lv)}"]`);
          if(target){
            target.open = true;
            const y = target.getBoundingClientRect().top + window.scrollY - 95;
            window.scrollTo({ top: y, behavior:"smooth" });
          }
        });
      });

      // æ¤œç´¢ï¼šã‚¿ã‚¤ãƒˆãƒ«ï¼‹descriptionã‚’å¯¾è±¡ã€‚çµæœã¯ä¸Šã«2åˆ—ã§è¡¨ç¤º
      function doSearch(){
        const q = searchInput.value.trim();
        if(!q){
          resultsBox.style.display = "none";
          resultsGrid.innerHTML = "";
          return;
        }

        const hit = rules.filter(r=>{
          const t = String(r.title || "");
          const d = String(r.description || "");
          const dt = String(r.detail || "");
          return t.includes(q) || d.includes(q) || dt.includes(q);
        });

        resultsBox.style.display = "block";
        resultsGrid.innerHTML = hit.length
          ? hit.map(r=>`<a class="ruleBtn" href="basic_rule_detail.html?id=${Number(r.id)}">${esc(r.title)}</a>`).join("")
          : `<div class="empty">è©²å½“ã™ã‚‹ãƒ«ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>`;

        // æ¤œç´¢ä¸­ã¯ãƒãƒƒãƒ—ã®activeã‚’å¤–ã™ï¼ˆä»»æ„ï¼‰
        chipRow.querySelectorAll(".chip").forEach(c=>c.classList.remove("active"));
      }

      searchInput.addEventListener("input", doSearch);
    });
  </script>
</body>
</html>
